"use strict";(()=>{var e={};e.id=232,e.ids=[232],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},9416:(e,t,r)=>{r.r(t),r.d(t,{config:()=>f,default:()=>p,routeModule:()=>d});var o={};r.r(o),r.d(o,{default:()=>E});var n=r(1802),i=r(7153),a=r(6249),s=r(3296),l=r(8975),c=r(7467);let u=["about","thesis","telegram"];async function E(e,t){let r;if("POST"!==e.method)return t.status(405).json({error:c.R.UNKNOWN});let{url:o,mode:n}=e.body||{};if(!o||"string"!=typeof o)return t.status(400).json({error:c.R.INVALID_URL});let i=u.includes(n)?n:"about";try{r=await (0,s.J)(o)}catch(e){return console.error("[fetchArticleText]",e),t.status(400).json({error:c.R.ARTICLE_FETCH_FAILED})}try{let e=await (0,l.h)(i,r,o);return t.status(200).json({result:e})}catch(e){return console.error("[callOpenRouter]",e instanceof Error?e.message:String(e),"| OPENROUTER_API_KEY:",process.env.OPENROUTER_API_KEY?.trim()?"present":"MISSING"),t.status(500).json({error:c.R.AI_PROCESSING_FAILED})}}let p=(0,a.l)(o,"default"),f=(0,a.l)(o,"config"),d=new n.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/article",pathname:"/api/article",bundlePath:"",filename:""},userland:o})},7467:(e,t,r)=>{r.d(t,{R:()=>o});let o={ARTICLE_FETCH_FAILED:"Не удалось загрузить статью по этой ссылке.",AI_PROCESSING_FAILED:"Не удалось обработать статью. Попробуйте позже.",IMAGE_GENERATION_FAILED:"Не удалось сгенерировать изображение. Попробуйте позже.",INVALID_URL:"Пожалуйста, введите URL статьи.",UNKNOWN:"Произошла ошибка. Попробуйте ещё раз."}},3296:(e,t,r)=>{r.d(t,{J:()=>o});async function o(e){let t=new AbortController,r=setTimeout(()=>t.abort(),3e4);try{let o=await fetch(e,{signal:t.signal,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml"}});if(clearTimeout(r),!o.ok)throw Error(`Не удалось загрузить статью (код ${o.status}). Сайт может ограничивать доступ.`);let n=(await o.text()).replace(/<script[\s\S]*?<\/script>/gi,"").replace(/<style[\s\S]*?<\/style>/gi,"").replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim();if(!n)throw Error("Не удалось извлечь текст из статьи. Страница может быть пустой или защищена.");return n.slice(0,15e3)}catch(e){if(clearTimeout(r),e instanceof Error){if("AbortError"===e.name)throw Error("Превышено время ожидания загрузки статьи (30 с). Попробуйте ещё раз.");if(e.message.includes("fetch failed")||e.message.includes("ECONNREFUSED")||e.message.includes("ENOTFOUND"))throw Error("Сайт недоступен. Проверьте URL и подключение к интернету.");throw e}throw Error("Не удалось загрузить статью. Попробуйте другой URL.")}}},8975:(e,t,r)=>{r.d(t,{h:()=>i,S:()=>a});let o=(process.env.OPENROUTER_API_KEY??"").replace(/^\[|\]$/g,""),n=process.env.OPENAI_BASE_URL??"https://openrouter.ai/api/v1";async function i(e,t,r){if(!o.trim())throw Error("OPENROUTER_API_KEY не задан в переменных окружения.");let i=function(e,t){switch(e){case"about":default:return"Кратко и понятным языком на русском объясни, о чем эта статья. 3–6 предложений.";case"thesis":return"Сделай структурированный список из 5–10 основных тезисов статьи на русском языке.";case"telegram":return"Составь готовый пост для Telegram на русском: живой, понятный, 1–3 абзаца, без упоминания, что текст создан ИИ. В конце поста добавь ссылку на источник статьи."+(t?` Укажи ссылку: ${t}`:"");case"illustration":return"На основе содержания статьи создай один короткий промпт на английском (до 80 слов) для генерации иллюстрации. Описание сцены: детальное, конкретное, подходящее для text-to-image модели. Стиль: реалистичный или художественный. Выведи ТОЛЬКО промпт, без кавычек и пояснений."}}(e,r),a=await fetch(`${n}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({model:"deepseek/deepseek-chat",messages:[{role:"system",content:"Ты помощник, который переводит и пересказывает англоязычные статьи на естественном русском языке."},{role:"user",content:["Ниже текст англоязычной статьи.","",t,"","Выполни следующее действие:",i].join("\n")}]})});if(!a.ok){let e=await a.text();throw Error(`Ошибка OpenRouter (${a.status}): ${e||"нет тела ответа"}`)}let s=await a.json(),l=s.choices?.[0]?.message?.content;if(!l)throw Error("Пустой ответ от модели Deepseek.");return l.trim()}async function a(e){return i("illustration",e)}},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=9416);module.exports=r})();